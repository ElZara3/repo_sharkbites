<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportar Incidencia - Metro CDMX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'metro-blue': '#0066CC',
                        'metro-orange': '#FF6B35'
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center px-4 py-12">
    <div class="max-w-2xl w-full bg-white rounded-lg shadow-xl p-8">
        <div class="text-center mb-8">
            <div class="w-16 h-16 bg-metro-orange rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-white font-bold text-2xl">üìã</span>
            </div>
            <h2 class="text-3xl font-bold text-gray-900">Enviar Reporte</h2>
            <p class="text-gray-600 mt-2">Sistema de Reportes - Metro CDMX</p>
        </div>

        <div id="successMessage" class="mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded hidden"></div>
        <div id="errorMessage" class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded hidden"></div>

        <form id="reportForm" class="space-y-4">
            <!-- L√≠nea del Metro -->
            <div>
                <label for="linea" class="block text-sm font-medium text-gray-700 mb-2">
                    L√≠nea del Metro <span class="text-red-500">*</span>
                </label>
                <select
                    id="linea"
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-metro-blue focus:border-transparent"
                >
                    <option value="">Seleccione una l√≠nea</option>
                    <option value="L√≠nea 1">L√≠nea 1 - Rosa</option>
                    <option value="L√≠nea 2">L√≠nea 2 - Azul</option>
                    <option value="L√≠nea 3">L√≠nea 3 - Verde Olivo</option>
                    <option value="L√≠nea 4">L√≠nea 4 - Cielo</option>
                    <option value="L√≠nea 5">L√≠nea 5 - Amarilla</option>
                    <option value="L√≠nea 6">L√≠nea 6 - Roja</option>
                    <option value="L√≠nea 7">L√≠nea 7 - Naranja</option>
                    <option value="L√≠nea 8">L√≠nea 8 - Verde</option>
                    <option value="L√≠nea 9">L√≠nea 9 - Caf√©</option>
                    <option value="L√≠nea 12">L√≠nea 12 - Dorada</option>
                    <option value="L√≠nea A">L√≠nea A - Morada</option>
                    <option value="L√≠nea B">L√≠nea B - Verde y Gris</option>
                </select>
            </div>

            <!-- Estaci√≥n -->
            <div>
                <label for="estacion" class="block text-sm font-medium text-gray-700 mb-2">
                    Estaci√≥n <span class="text-red-500">*</span>
                </label>
                <select
                    id="estacion"
                    required
                    disabled
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-metro-blue focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"
                >
                    <option value="">Primero selecciona una l√≠nea</option>
                </select>
            </div>

            <!-- Nombre del Remitente -->
            <div>
                <label for="nombre_remitente" class="block text-sm font-medium text-gray-700 mb-2">
                    Nombre Completo
                </label>
                <input
                    id="nombre_remitente"
                    type="text"
                    maxlength="100"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-metro-blue focus:border-transparent"
                    placeholder="Tu nombre (opcional)"
                />
            </div>

            <!-- Email del Remitente -->
            <div>
                <label for="email_remitente" class="block text-sm font-medium text-gray-700 mb-2">
                    Email
                </label>
                <input
                    id="email_remitente"
                    type="email"
                    maxlength="100"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-metro-blue focus:border-transparent"
                    placeholder="tu@email.com (opcional)"
                />
            </div>

            <!-- Categor√≠a -->
            <div>
                <label for="categoria" class="block text-sm font-medium text-gray-700 mb-2">
                    Categor√≠a <span class="text-red-500">*</span>
                </label>
                <select
                    id="categoria"
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-metro-blue focus:border-transparent"
                >
                    <option value="">Seleccione una categor√≠a</option>
                    <option value="Trabajadores">Trabajadores</option>
                    <option value="Consultas/Dudas">Consultas/Dudas</option>
                    <option value="Sugerencias">Sugerencias</option>
                    <option value="Retrasos">Retrasos</option>
                    <option value="Asientos reservados">Asientos reservados</option>
                    <option value="Fallas T√©cnicas">Fallas T√©cnicas</option>
                    <option value="Mantenimiento/Limpieza">Mantenimiento/Limpieza</option>
                    <option value="Accesibilidad">Accesibilidad</option>
                    <option value="Cancelaciones">Cancelaciones</option>
                    <option value="Informaci√≥n/Comunicaci√≥n">Informaci√≥n/Comunicaci√≥n</option>
                    <option value="Seguridad">Seguridad</option>
                    <option value="Trato del Personal">Trato del Personal</option>
                    <option value="Espacio/Capacidad">Espacio/Capacidad</option>
                </select>
            </div>

            <!-- Asunto -->
            <div>
                <label for="asunto" class="block text-sm font-medium text-gray-700 mb-2">
                    Asunto <span class="text-red-500">*</span>
                </label>
                <input
                    id="asunto"
                    type="text"
                    required
                    maxlength="255"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-metro-blue focus:border-transparent"
                    placeholder="Breve descripci√≥n del problema"
                />
            </div>

            <!-- Contenido -->
            <div>
                <label for="contenido" class="block text-sm font-medium text-gray-700 mb-2">
                    Descripci√≥n Detallada <span class="text-red-500">*</span>
                </label>
                <textarea
                    id="contenido"
                    required
                    rows="5"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-metro-blue focus:border-transparent resize-vertical"
                    placeholder="Describe tu reporte de manera detallada..."
                ></textarea>
            </div>

            <!-- Bot√≥n de Env√≠o -->
            <button
                type="submit"
                id="submitButton"
                class="w-full px-4 py-3 bg-metro-blue text-white rounded-lg font-semibold hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed mt-6"
            >
                Enviar Reporte
            </button>
        </form>

        <div class="mt-6 text-center">
            <a href="dashboard.html" class="text-gray-500 hover:text-gray-700">
                ‚Üê Volver al panel
            </a>
        </div>
    </div>

    <script>
        // Datos de las l√≠neas y estaciones del Metro CDMX
        const datosMetro = {
            "L√≠nea 1": ["Observatorio", "Tacubaya", "Juanacatl√°n", "Chapultepec", "Sevilla", "Insurgentes", "Cuauht√©moc", "Balderas", "Salto del Agua", "Isabel la Cat√≥lica", "Pino Su√°rez", "Merced", "Candelaria", "San L√°zaro", "Moctezuma", "Balbuena", "Boulevard Puerto A√©reo", "G√≥mez Far√≠as", "Zaragoza", "Pantitl√°n"],
            "L√≠nea 2": ["Cuatro Caminos", "Panteones", "Tacuba", "Cuitl√°huac", "Popotla", "Colegio Militar", "Normal", "San Cosme", "Revoluci√≥n", "Hidalgo", "Bellas Artes", "Allende", "Z√≥calo", "Pino Su√°rez", "San Antonio Abad", "Chabacano", "Viaducto", "Xola", "Villa de Cort√©s", "Nativitas", "Portales", "Ermita", "General Anaya", "Tasque√±a"],
            "L√≠nea 3": ["Indios Verdes", "Deportivo 18 de Marzo", "Potrero", "La Raza", "Tlatelolco", "Guerrero", "Hidalgo", "Ju√°rez", "Balderas", "Ni√±os H√©roes", "Hospital General", "Centro M√©dico", "Etiop√≠a", "Eugenia", "Divisi√≥n del Norte", "Zapata", "Coyoac√°n", "Viveros", "Miguel √Ångel de Quevedo", "Copilco", "Universidad"],
            "L√≠nea 4": ["Mart√≠n Carrera", "Talism√°n", "Bondojito", "Consulado", "Canal del Norte", "Morelos", "Candelaria", "Fray Servando", "Jamaica", "Santa Anita"],
            "L√≠nea 5": ["Polit√©cnico", "Instituto del Petr√≥leo", "Autobuses del Norte", "La Raza", "Misterios", "Valle G√≥mez", "Consulado", "Eduardo Molina", "Arag√≥n", "Ocean√≠a", "Terminal A√©rea", "Hangares", "Pantitl√°n"],
            "L√≠nea 6": ["El Rosario", "Tezoz√≥moc", "Azcapotzalco", "Ferrer√≠a", "Norte 45", "Vallejo", "Instituto del Petr√≥leo", "Lindavista", "Deportivo 18 de Marzo", "La Villa-Bas√≠lica", "Mart√≠n Carrera"],
            "L√≠nea 7": ["El Rosario", "Aquiles Serd√°n", "Camarones", "Refiner√≠a", "Tacuba", "San Joaqu√≠n", "Polanco", "Auditorio", "Constituyentes", "Tacubaya", "San Pedro de los Pinos", "San Antonio", "Mixcoac", "Barranca del Muerto"],
            "L√≠nea 8": ["Garibaldi/Lagunilla", "Bellas Artes", "San Juan de Letr√°n", "Salto del Agua", "Doctores", "Obrera", "Chabacano", "La Viga", "Santa Anita", "Coyuya", "Iztacalco", "Apatlaco", "Aculco", "Escuadr√≥n 201", "Atlalilco", "Iztapalapa", "Cerro de la Estrella", "UAM-I", "Constituci√≥n de 1917"],
            "L√≠nea 9": ["Tacubaya", "Patriotismo", "Chilpancingo", "Centro M√©dico", "L√°zaro C√°rdenas", "Chabacano", "Jamaica", "Mixiuhca", "Vel√≥dromo", "Ciudad Deportiva", "Puebla", "Pantitl√°n"],
            "L√≠nea 12": ["Mixcoac", "Insurgentes Sur", "Hospital 20 de Noviembre", "Zapata", "Parque de los Venados", "Eje Central", "Ermita", "Mexicaltzingo", "Atlalilco", "Culhuac√°n", "San Andr√©s Tomatl√°n", "Lomas Estrella", "Calle 11", "Perif√©rico Oriente", "Tezonco", "Olivos", "Nopalera", "Zapotitl√°n", "Tlaltenco", "Tl√°huac"],
            "L√≠nea A": ["Pantitl√°n", "Agr√≠cola Oriental", "Canal de San Juan", "Tepalcates", "Guelatao", "Pe√±√≥n Viejo", "Acatitla", "Santa Marta", "Los Reyes", "La Paz"],
            "L√≠nea B": ["Ciudad Azteca", "Plaza Arag√≥n", "Ol√≠mpica", "Ecatepec", "M√∫zquiz", "R√≠o de los Remedios", "Impulsora", "Nezahualc√≥yotl", "Villa de Arag√≥n", "Bosque de Arag√≥n", "Deportivo Ocean√≠a", "Ocean√≠a", "Romero Rubio", "R. Flores Mag√≥n", "San L√°zaro", "Morelos", "Tepito", "Lagunilla", "Garibaldi/Lagunilla", "Guerrero", "Buenavista"]
        };

        // Obtener elementos
        const lineaSelect = document.getElementById('linea');
        const estacionSelect = document.getElementById('estacion');

        // Evento para cambiar las estaciones cuando se selecciona una l√≠nea
        lineaSelect.addEventListener('change', function() {
            const lineaSeleccionada = this.value;
            
            // Limpiar el select de estaciones
            estacionSelect.innerHTML = '<option value="">Seleccione una estaci√≥n</option>';
            
            if (lineaSeleccionada && datosMetro[lineaSeleccionada]) {
                // Habilitar el select de estaciones
                estacionSelect.disabled = false;
                
                // Agregar las estaciones de la l√≠nea seleccionada
                datosMetro[lineaSeleccionada].forEach(estacion => {
                    const option = document.createElement('option');
                    option.value = estacion;
                    option.textContent = estacion;
                    estacionSelect.appendChild(option);
                });
            } else {
                // Deshabilitar el select si no hay l√≠nea seleccionada
                estacionSelect.disabled = true;
                estacionSelect.innerHTML = '<option value="">Primero selecciona una l√≠nea</option>';
            }
        });

        // Manejo del formulario
        document.getElementById('reportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const linea = document.getElementById('linea').value;
            const estacion = document.getElementById('estacion').value;
            const nombre_remitente = document.getElementById('nombre_remitente').value;
            const email_remitente = document.getElementById('email_remitente').value;
            const categoria = document.getElementById('categoria').value;
            const asunto = document.getElementById('asunto').value;
            const contenido = document.getElementById('contenido').value;
            
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const submitButton = document.getElementById('submitButton');
            
            // Ocultar mensajes previos
            errorMessage.classList.add('hidden');
            successMessage.classList.add('hidden');
            
            // Validaciones b√°sicas
            if (!linea || !estacion || !categoria || !asunto || !contenido) {
                errorMessage.textContent = 'Por favor completa todos los campos obligatorios (*)';
                errorMessage.classList.remove('hidden');
                return;
            }
            
            // Deshabilitar bot√≥n
            submitButton.disabled = true;
            submitButton.textContent = 'Enviando reporte...';
            
            try {
                // Preparar datos para enviar
                const reportData = {
                    linea: linea,
                    estacion: estacion,
                    nombre_remitente: nombre_remitente || null,
                    email_remitente: email_remitente || null,
                    asunto: asunto,
                    contenido: contenido,
                    categoria: categoria
                    // fecha se generar√° autom√°ticamente en el backend
                };
                
                console.log('Datos a enviar:', reportData);
                
                // --- INICIO DE CODIGO NUEVO ---
                // Llamada real al backend Python
                const response = await fetch('http://127.0.0.1:8000/reportes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(reportData)
                });
                
                if (!response.ok) {
                    throw new Error('Error al conectar con el servidor Python');
                }
                
                const data = await response.json();
                console.log("Respuesta del servidor:", data);
                // --- FIN DE CODIGO NUEVO ---

                // Simulaci√≥n de env√≠o exitoso (Visual)
                setTimeout(() => {
                    // ... resto de tu c√≥digo original para mostrar mensaje √©xito
                    successMessage.textContent = '‚úì Reporte enviado exitosamente';
                    successMessage.classList.remove('hidden');
                    
                    // Limpiar formulario
                    document.getElementById('reportForm').reset();
                    
                    // Deshabilitar el select de estaciones nuevamente
                    estacionSelect.disabled = true;
                    estacionSelect.innerHTML = '<option value="">Primero selecciona una l√≠nea</option>';
                    
                    // Restaurar bot√≥n
                    submitButton.disabled = false;
                    submitButton.textContent = 'Enviar Reporte';
                    
                    // Scroll hacia arriba para ver el mensaje
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    // Opcional: Redireccionar despu√©s de 2 segundos
                    // setTimeout(() => {
                    //     window.location.href = 'dashboard.html';
                    // }, 2000);
                }, 1500);
                
            } catch (error) {
                console.error('Error:', error);
                errorMessage.textContent = 'Error al enviar el reporte. Intenta nuevamente.';
                errorMessage.classList.remove('hidden');
                submitButton.disabled = false;
                submitButton.textContent = 'Enviar Reporte';
            }
        });
    </script>
</body>
</html>